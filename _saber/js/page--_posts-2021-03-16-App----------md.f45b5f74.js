(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{62:function(t,e,n){"use strict";n.r(e);var a=n(0),c=function(t){var e,n,a,c,l,o,i,s=(e=void 0,c="App端动态绘制分享卡片",l="遇到问题",o="可行方案",i="实现细节",(n={}).type=a="post",n.internal=e,n.contentType="markdown",n.slug=c,n.content=e,n.createdAt=new Date(16158528e5),n.updatedAt=new Date(1615987534722),n.title=c,n.date="2021-03-16",n.layout=a,n.markdownHeadings=[{text:l,slug:l,level:2},{text:o,slug:o,level:2},{text:i,slug:i,level:2},{text:"总结",slug:"总结",level:2}],n.excerpt="<p>需求是在不同用户信息和分享内容的情况下，动态绘制下面的分享卡片，用户可以保存到手机中或通过分享API即时分享。</p>\n",n.permalink="/2021/03/16/App端动态绘制分享卡片",n.assets={},n.attributes=n,n.prevPost={title:"跳转第三方App",permalink:"/2021/03/07/跳转第三方App"},n.nextPost=e,n),r=t.options.beforeCreate||[];t.options.beforeCreate=[function(){this.$page=s}].concat(r);["layout","transition"].forEach((function(e){var n=t.options.PageComponent;n&&(t.options[e]=n[e]),void 0===t.options[e]&&(t.options[e]=s[e])})),s.slug&&(t.options.name="page-wrapper-"+s.slug.replace(/[^0-9a-z\-]/gi,"-"))},l=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layout-manager",[n("h2",{attrs:{id:"遇到问题"}},[t._v("遇到问题")]),t._v(" "),n("p",[t._v("需求是在不同用户信息和分享内容的情况下，动态绘制下面的分享卡片，用户可以保存到手机中或通过分享API即时分享。")]),t._v(" "),n("img",{staticStyle:{zoom:"25%"},attrs:{src:"https://ls-img-store.oss-cn-qingdao.aliyuncs.com/img/post-2021-3-17.png"}}),t._v(" "),n("p",[t._v("在H5端是很好实现的， 大致流程是：")]),t._v(" "),n("ol",[n("li",[t._v("使用"),n("code",{pre:!0},[t._v("html2canvs")]),t._v("把html转化成canvas")]),t._v(" "),n("li",[n("code",{pre:!0},[t._v("canvas.toDataURL(type, encoderOptions);")]),t._v(" canvas转图片base64")]),t._v(" "),n("li",[n("code",{pre:!0},[t._v("dataURLtoBlob()")]),t._v(" base64转图片二进制 blob 对象")]),t._v(" "),n("li",[n("code",{pre:!0},[t._v("URL.createObjectURL()")]),t._v(" blob对象转对象URL")]),t._v(" "),n("li",[t._v("使用"),n("code",{pre:!0},[t._v("<a>")]),t._v("或者"),n("code",{pre:!0},[t._v("uni.downloadFile()")]),t._v("下载图片即可")])]),t._v(" "),n("p",[t._v("但在App端，视图层和逻辑层是分离的，在逻辑层拿不到视图层的"),n("code",{pre:!0},[t._v("document")]),t._v("对象，也就无法使用"),n("code",{pre:!0},[t._v("html2canvas")]),t._v("。")]),t._v(" "),n("p",[t._v("又尝试了内置的"),n("code",{pre:!0},[t._v("wxs")]),t._v("，由于"),n("code",{pre:!0},[t._v("wxs")]),t._v("是运行在视图层的脚本语言，自然可以使用"),n("code",{pre:!0},[t._v("document")]),t._v("对象，但是，在App端中无法使用"),n("code",{pre:!0},[t._v("<a>")]),t._v("标签下载文件，"),n("code",{pre:!0},[t._v("wxs")]),t._v("又不能使用"),n("code",{pre:!0},[t._v("uni")]),t._v("各种接口，即使是通过"),n("code",{pre:!0},[t._v("ownerInstance")]),t._v("传值给"),n("code",{pre:!0},[t._v("uni")]),t._v("，然后调用"),n("code",{pre:!0},[t._v("uni.downloadFile()")]),t._v("下载，也因为跨越两个脚本环境、且对象URL只针对当前环境有效的原因，也无法顺利进行。")]),t._v(" "),n("h2",{attrs:{id:"可行方案"}},[t._v("可行方案")]),t._v(" "),n("p",[t._v("使用canvas手动绘制出卡片内容，然后使用"),n("code",{pre:!0},[t._v("uni.canvasToTempFilePath()")]),t._v("获取对象URL和"),n("code",{pre:!0},[t._v("uni.saveImageToPhotosAlbum()")]),t._v("保存图片到相册即可。")]),t._v(" "),n("h2",{attrs:{id:"实现细节"}},[t._v("实现细节")]),t._v(" "),n("p",[t._v("代码细节")]),t._v(" "),n("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":"js"}},[n("pre",{pre:!0,attrs:{class:"saber-highlight-code language-js"}},[n("code",{pre:!0,attrs:{class:"language-js"}},[t._v("changeCanvas: function() {\t\t\n    let ctx = uni.createCanvasContext('myCanvas')\n    let centerStr = 119\n\n    // 深灰色背景\n    ctx.fillStyle = '#555'\n    ctx.fillRect(0, 0, 238, 456)\n\n    // 白色背景\n    // ctx.fillStyle = '#fff'\n    // ctx.fillRect(10, 28, 218, 398)\n    ctx.beginPath()\n    ctx.moveTo(20, 28)\n    // 左上角\n    ctx.arc(20, 38, 10, Math.PI, Math.PI*3/2)\n    // 上边线\n    ctx.lineTo(218, 28)\n    // 右上角\n    ctx.arc(215, 38, 10, Math.PI*3/2, 0)\n    // 右边线\n    ctx.lineTo(225, 412)\n    // 右下角\n    ctx.arc(215, 412, 10, 0, Math.PI/2)\n    // 下边线\n    ctx.lineTo(20, 422)\n    // 左下角\n    ctx.arc(20, 412, 10, Math.PI/2, Math.PI)\n    // 左边线\n    ctx.lineTo(10, 38)\n    // ctx.closePath()\n    ctx.fillStyle = '#fff'\n    ctx.fill()\n\n    // 用户名\n    ctx.textAlign = 'center'\n    // ctx.setTextAlign('center')\n    ctx.fillStyle = '#333'\n    ctx.setFontSize(18)\n    ctx.fillText('Hello', centerStr, 69)\n    // 广告语\n    ctx.fillStyle = '#999'\n    ctx.setFontSize(10)\n    ctx.fillText('在'+this.$mConfig.appName+'App发现了一篇好文章', centerStr, 90)\n\n    // 文章标题\n    ctx.fillStyle = '#333'\n    ctx.setFontSize(18)\n    let str = this.passageDetail.title\n    ctx.fillText(str.substring(0, 10), centerStr, 260)\n    if(str.length > 10) ctx.fillText(str.substring(10, 18)+'...', centerStr, 282)\n\n    // 文章摘要\n    ctx.fillStyle = '#888'\n    ctx.setFontSize(12)\n    let profile = this.passageDetail.describe\n    ctx.fillText(profile.substring(0, 13), centerStr, 310)\n    if(profile.length > 10) ctx.fillText(profile.substring(13, 22)+'...', centerStr, 329)\n\n    // 间隔线\n    ctx.strokeStyle = '#CED0D1'\n    ctx.moveTo(30, 350)\n    ctx.lineTo(208, 350)\n    ctx.stroke()\n\n    // 提示\n    ctx.textAlign = 'left'\n    ctx.fillText('长按识别二维码收听', 90, 380)\n    ctx.fillText(this.userinfo.user_nickname, 90, 399)\n\n    // 文章logo\n    // ctx.drawImage(this.shareImgMetarials[1].path, 80, 126, 119, 119)\n    ctx.drawImage(this.passageDetail.thumbnail, 66, 109, 119, 119)\n\n    // 二维码\n    ctx.drawImage(this.shareQrcode, 30, 360, 46, 46)\n\n    // 用户logo\n    ctx.save()\n    ctx.stroke()\n    ctx.beginPath();\n    ctx.moveTo(62, 12)\n    ctx.arc(117, 27, 15, 0, Math.PI*2, false);\n    ctx.clip();\n    ctx.drawImage(this.userinfo.avatar, 102, 12, 30, 30)\n    ctx.restore()\n\n    ctx.draw()\n}")])])]),n("h2",{attrs:{id:"总结"}},[t._v("总结")]),t._v(" "),n("p",[t._v("App的混合开发确实方便快捷，但是也会在不时遇到的因为非原生开发带来的棘手问题时，感觉力不从心， 而转向原生开发又违背混合开发的初心，现在只能先暂时寄希望于行业能力慢慢迭代，打破这个循环。")])])}),[],!1,null,null,null);"function"==typeof c&&c(l);e.default=l.exports}}]);